\input{header.tex}

\setchapterpreamble[u]{% 
\dictum[Anonymous]{Forecasting is the art of saying 
what is going to happen and then to explain 
why it didnâ€™t.}} 

\chapter{Data wrangling}

\section{Introduction}\label{sec:introduction}

To get the most out of ggplot, you need to be able to get your data into the form that {\tt ggplot} wants.  This chapter discusses what the best format is, and some ways to get your data into that form.  It includes an introduction to the {\tt reshape} package, which is a very useful companion to {\tt ggplot}.  I also discuss facetting and its uses in more detail, as well as providing many examples so that you can get more of an idea how it works.

Unlike other graphics packages in R, {\tt ggplot} provides very few ways to get your data in.  For example, lattice functions can take an optional data frame or use vectors direct from the environment.  {\tt ggplot} only works with data in the form of a data frame (although qplot provides a convenient way of creating a data frame from vectors that exist in your data space).  This means that you have to explicitly arrange your data in the format that ggplot uses.  This makes it a little bit more verbose, but you can be more sure about exactly what is going on with your data.  It also allows a cleaner separation of concerns so that the graphics package deals only with plotting data, not wrangling it into different forms as well.

The package that I recommend for getting data into the right form (because I wrote it!), is {\tt reshape}.

This corresponds to my general philosophy on data.  

The most important thing is that everything should be explicit.  Your data is the most important thing, and if it gets corrupted or arranged in an inappropriate manner everything based on that data will be compromised.  For this reason, you need to do everything yourself.

Use lower case column names (a bit easier to type, but main thing is to be consistent)

\section{Using reshape}\label{sec:using_reshape}

A useful tool for getting data into the right shape to plot.  See the reshape documentation for more details.  Here is a basic introduction and some examples particularly relevant for {\tt ggplot}.

\section{Facetting}\label{sec:facetting}

Facetting is discussed previous in XXX and XXX.  Here I will go into more detail, and provide more examples.

You can set up facetting when you create the plot, {\tt ggplot(df, a ~ b)}, or later using \texttt{setfacets(p, formula = . ~ . , margins = FALSE)}.

\subsection{Multiple categorical variables}\label{sub:multiple_categorical_variables}

\subsection{Structural vs non-structural missings}\label{sub:structural_vs_non_structural_missings}

(Ask Phil if there is a better name)

\subsection{Continuous variables}\label{sub:continuous_variables}

To use continuous variables as facetting variables, you will first need to convert them to categorical.  Also, the facetting formula currently does not support calculated variables, so you will need to save them in the data frame first.

\subsection{Missing facetting columns}\label{sub:missing_facetting_columsn}

If you facet on the original data set and later add columns


\input{footer.tex}
