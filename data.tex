\input{_header.tex}

\chapter{Data wrangling}

\section{Introduction}\label{sec:introduction}

To get the most out of ggplot, you need to be able to get your data into the form that {\tt ggplot} wants.  This chapter discusses what the best format is, and some ways to get your data into that form.  It includes an introduction to the {\tt reshape} and {\tt plyr} packages, which is a very useful companion to {\tt ggplot}.  I also discuss facetting and its uses in more detail, as well as providing many examples so that you can get more of an idea how it works.

Unlike other graphics packages in R, {\tt ggplot} provides very few ways to get your data in.  For example, lattice functions can take an optional data frame or use vectors direct from the environment.  {\tt ggplot} only works with data in the form of a data frame (although qplot provides a convenient way of creating a data frame from vectors that exist in your data space).  This means that you have to explicitly arrange your data in the format that ggplot uses.  This makes it a little bit more verbose, but you can be more sure about exactly what is going on with your data.  It also allows a cleaner separation of concerns so that the graphics package deals only with plotting data, not wrangling it into different forms as well.

The package that I recommend for getting data into the right form (because I wrote it!), is {\tt reshape}.

This corresponds to my general philosophy on data.  

This makes it very easy to produce the same plot for different data sets.  A single data.frame is also easier to save than a multitude of vectors, which means it's easier to reproduce your results later or send them to someone else.  

The most important thing is that everything should be explicit.  Your data is the most important thing, and if it gets corrupted or arranged in an inappropriate manner everything based on that data will be compromised.  For this reason, you need to do everything yourself.

Use lower case column names (a bit easier to type, but main thing is to be consistent)

\section{Using reshape}\label{sec:using_reshape}

A useful tool for getting data into the right shape to plot.  See the reshape documentation for more details, especially the introductory pdf.  The ``molten'' form can be useful in conjunction with {\tt ggplot} if your variables are all on the same scale, as you can plot many of the variables at once using line geoms and the {\tt group} attribute.  This is similar to what the parallel coordinates plot does.

Here is a basic introduction and some examples particularly relevant for {\tt ggplot}.

% decumar<<< 
% interweave({
% str(smiths)
% })
% |||
%>>>

\begin{alltt}
df <- data.frame(
  time = 1:10, 
  a = 1:10, 
  b = rnorm(10), 
  c = (1:10)^2/10, 
  d = sin(1:10 * pi/2)
)

dfm <- melt(df, id="time")
head(dfm)
qplot(time, value, data=dfm, . ~ variable, type="line")

# or if you _really_ want a 2x2 matrix

dfm$a <- ifelse(dfm$variable %in% c("a","b"), 1, 2)
dfm$b <- ifelse(dfm$variable %in% c("a","c"), 1, 2)

qplot(time, value, data=dfm, a ~ b, type="line")
\end{alltt}


\input{_footer.tex}
