---
title: "Notes on ggplot2 book"
author: Ian Lyttle

output: html_document
---

Some background: in 2012, I decided that I needed to teach myself R. I was progressing in fits and starts until I stumbled upon this one name that just kept popping up over and over (guess who). A simple googling of images for ggplot2 convinved me that I needed to learn this dark art. So I ordered the book, and then made the fateful decision that for one week, Schneider Electric was going pay me to read and code along with the book, cover-to-cover. I made a few notes in the margins along the way (not many, because the book was very well written). Here are those notes, along with a few observations from 2014.  

I don't see any edition information on my copy, so I'll have to hope that the page numbers are meaningful.

```{r}
library(ggplot2)
```

#### p. 86

```{r}
unemp <- qplot(date, unemploy, data = economics, geom = "line", 
               xlab = "", ylab = "No. unemployed (1000s)")

unemp
```

The red and blue layer needs `library(scales)`; this could be made clearer.

```{r}
library(scales)

yrng <- range(economics$unemploy)
unemp + 
  geom_rect(
    aes(NULL, NULL, xmin = start, xmax= end, fill = party),
    ymin = yrng[1], ymax = yrng[2],
    data = presidential
  ) + 
  scale_fill_manual(values = alpha(c("blue", "red"), 0.2))
```

#### p. 96

At the bottom of the page, there is a description of limits. 

> Any value not in the domain of the scale is discarded ... This discarding occurs before statistics are calculated.

I made a star, and a note that this is "very important". Until I understood this point I was (frustratingly) getting results that I did not understand. Perhaps this point could be given more prominence.

#### p. 101

Bottom of page

```{r}
plot <- qplot(date, psavert, data = economics, geom = "line") + 
  ylab("Personal savings rate") + 
  geom_hline(xintercept = 0, colour = "grey50")

plot

plot + scale_x_date(breaks = "10 years")
plot + scale_x_date(
  limits = as.Date(c("2004-01-01", "2005-01-01")),
  labels = date_format("%Y-%m-%d")  
)
```

This brings up another point that I'll come back to later. Since the publication in 2009, we have had the introduction of `lubridate` (not to mention `dplyr`). Is it thought to update the examples accordingly (I know this is a lot of work)? Is it even a good idea?

```{r}
library(lubridate)

plot + scale_x_date(
  limits = as.Date(c("2004-01-01", "2005-01-01")), # can this be made easier?
  labels = stamp("2004-12-31")  
)
```

#### p. 106

There is a discussion here on color scales. For me the Brewer palette has been a very useful feature, and I think the site has been updated: http://colorbrewer2.org/ (the old url seems to forward)

In listening to Di, she has pointed out situations where sequential, diverging, and qualitative scales are appropriate. Brewer has been my go-to place to get the right palette.

#### p. 107

`value -> values`

```{r}
plot <- qplot(brainwt, bodywt, data = msleep, log = "xy")

plot + 
  aes(colour = vore) + 
  scale_color_manual(values = c("red", "orange", "yellow", "green", "blue"))

colours <- c(carni = "red", "NA" = "orange", insecti = "yellow", herbi = "green", omni = "blue")

# p. 108
plot + aes(colour = vore) + scale_color_manual(values = colours)

plot + 
  aes(shape = vore) + 
  scale_shape_manual(values = c(1, 2, 6, 0, 23))
```


#### p. 109

```{r}
huron <- data.frame(year = 1875:1972, level = LakeHuron)
```

`scale_color_manual` seems to need an explicit `values`.

```{r}
ggplot(huron, aes(year)) + 
  geom_line(aes(y = level - 5, colour = "below")) + 
  geom_line(aes(y = level + 5, colour = "above")) + 
  scale_color_manual("Direction", values = c("below" = "blue", "above" = "red"))
```

#### p. 121

This gets a little more philisophical. With the introduction of `tidyr`, is is appropriate to replace `melt` with `gather`?

```{r}
library(tidyr)

em <- gather(economics, key = "variable", value = "value", -date)
qplot(date, value, data = em, geom = "line", group = "variable") + 
  facet_grid(variable ~ ., scale = "free_y")
```

#### p. 129

There is a discussion here including the quote:

> one day I hope to add 3d graphics too.

Given that ggplot2 is now in maintenance mode, could/should this package be rephrased?

I don't know if this is the place for the larger discussion on the dangers of 3d. As I understand the arguement, 3d is a great way to hide diffiicult parts of your data, accidentally or otherwise. I remember one talk Hadley gave that touched on using heuristics, such as size and layering, to give the impression of 3d while still respecting the two dimensions being shown.

I don't know, as well, if this is a good place (or if there is a good place) to talk about some common graphing techniques, such as 2nd y-axis, or 3d, that (by definition) are contrary to grammar-of-graphics, and what grammar-of-graphics techniques can be used to convey the same information, perhaps not quite as concisely, but with less abiguity.

#### Chapter 9 

Is it thought to convert to `dplyr` and `tidyr`?

We have tidy tools for data transformation and visualization. I know it remains on the to-do list for modeling. Is this a place to discuss that, as well as some of the efforts made so far, including `broom` (which I sadly have not had time to look at yet)?

```{r}
library(plyr)
# select the two smallest diamonds
ddply(diamonds, .(color), subset, order(carat) <= 2)

# I always get turned-around on this, but I think you want rank here.
ddply(diamonds, .(color), subset, rank(carat) <= 2)

# the problem is that rank seems to operate on the entire dataframe, not the group.
```

```{r}
library(dplyr)
diamonds %>%
  group_by(color) %>%
  top_n(2, desc(carat))
```