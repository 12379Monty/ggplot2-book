\input{_header.tex}

\chapter{Polishing your plots for publication}
\label{cha:theming}


In ggplot, the appearance and the structure of the plot are quite separate.  This is different to base and lattice graphics in that you do not specify the appearance of the plot while you are creating it (defining its structure).  In base and lattice graphics, most functions take a very large number arguments that specify the finer points of appearance, which can make the functions complicated and hard to understand.  Instead, in ggplot you create the plot in one step, and then {\em after} it has been created you can edit every detail of the rendering, using \pkg{grid}.

Themes allow you to customise the appearance of non-data elements of the plot.  Like many other areas of \ggplot, there are multiple levels of control:

\begin{itemize}
  \item Select (and adjust the parameters of) one of the built in themes.  This affects every visual element of the plot in a visually consistent manner.  \secref{sec:built_in}.

  \item Each theme is made up of multiple elements The theme system comes with a number of built in element rendering functions with a limited set of parameters.  By adjusting these parameters you can control things like text size and colour, background and grid line colours and text orientation. Alternatively, you can write a custom element function using grid.  This allows you to absolutely customise the appearance of every element - you are not restricted to a built in set of drawing options.  \secref{sec:theme_elements}

  \item Use grid to alter a single item on the plot
\end{itemize}

\noindent Theme settings can be applied on two levels:

\begin{itemize}
  \item Globally, using \f{theme}.  Global options are applied when a plot is rendered, not when it is created.  This lets you experiment with plot structure and appearance independently.

  \item For individual plots, using \f{opts}.  Local options override global options.  To apply the same set of options to multiple plots, you can assign the result of \f{opts} to a variable, and then add that variable to each plot.
\end{itemize}

\section{Built in themes}
\label{sec:built_in}

There are two built in themes.  The default has a grey background, and the other theme has a white background.

Both these themes share a common set of parameters that allow you to perform the most common set of adjustments, including setting global text properties (like font family and size) and adjusting colours.  

\begin{itemize}
  \item Font size.  Title is 120\%, tick labels are 80\%.
  \item Colour
\end{itemize}

% EXAMPLES
% 
% Change font size
% Use black and white theme
% Use custom colours (blues)

\section{Theme elements}
\label{sec:theme_elements}

Each theme elements renders a single element of the non-data components of plot.  Table~\ref{tbl:elements} lists all of the customisable elements in a plot.

\begin{table}
  \begin{center}
  \begin{tabular}{lll}\\
    \toprule
    Theme element              & Type   & Description  \\
    \midrule                             
    \texttt{axis.line}         & line   & Line along axis  \\
    \texttt{axis.text.x}       & text   & x axis label  \\
    \texttt{axis.text.y}       & text   & y axis label  \\
    \texttt{axis.ticks}        & line   & axis tick marks  \\
    \texttt{axis.title.x}      & text   & x axis tick labels  \\
    \texttt{axis.title.y}      & text   & y axis tick labels  \\[0.5em]
    \texttt{legend.background} & rect   & background of legend  \\
    \texttt{legend.key}        & rect   & background underneath legend keys \\
    \texttt{legend.text}       & text   & legend labels  \\
    \texttt{legend.title}      & text   & legend name  \\[0.5em]
    \texttt{panel.background}  & rect   &   \\
    \texttt{panel.border}      & rect   &   \\
    \texttt{panel.grid.major}  & line   &   \\
    \texttt{panel.grid.minor}  & line   &   \\[0.5em]
    \texttt{plot.box}          & rect   &   \\
    \texttt{plot.title}        & text   &   \\[0.5em]
    \texttt{strip.background}  & rect   &   \\
    \texttt{strip.label}       &        &   \\
    \texttt{strip.title.x}     & text   &   \\
    \texttt{strip.title.y}     & text   &   \\
    \bottomrule
  
  \end{tabular}
  \end{center}
  \caption{Theme elements}
  \label{tbl:elements}
\end{table}

The element type describes what sort of output that element uses, and roughly matches the grid grobs of the same name.  The following sections describes the built in element functions that you can use, or if those don't offer enough customisation, how to write your own.

\subsection{Built-in element functions}

\begin{itemize}
  \item \code{theme_text}
  \item \code{theme_line}
  \item \code{theme_rect}
\end{itemize}

% EXAMPLES
% 
% Change angle of axis labels
% 

\subsection{Custom element functions}

To see how to write custom element functions, it's good to start by seeing how the built in element functions work:

% INTERWEAVE
% 
% str(args(theme_text()))
% str(args(theme_rect()))
% str(args(theme_line()))

You'll notice that these are very similar to the arguments to \f{textGrob}, \f{rectGrob} and \f{polylineGrob} and these are exactly the functions that they are based on.  All that the element function do is set up some defaults.  

If you want to write your own, you need to copy this basic idea: take position arguments, and return a grid grob.  For example, let's say we'd like to give the strips a 3d appearance.  We can do this by drawing a rectangle, and then drawing highlights on the top-right and low-lights (shadows) on the bottom-left.


\section{Customising scales and geoms}

\section{Saving your output}
\label{sec:saving}

Difference between raster and vector.  Vector is ``infinitely'' zoomable, but can take up a lot of space and for plots with very many points can take a long time to render (on screen and for printer).

R output generally works best as part of a *nix development tool chain: using Cairo for output, and inserting into latex files.  However, this section also covers tip and tricks for making your windows experience as smooth as possible.

\begin{table}
  \begin{center}
  \begin{tabular}{lll}
    \toprule
    Graphics device & Type & Recommended for \\
    \midrule
    pdf   & vector & pdflatex\\
    ps    & vector & latex \\
    png   & raster & web, pdflatex \\
    tiff  & raster & \\
    wmf   & raster & Microsoft office \\
    \bottomrule 
  \end{tabular}
  \end{center}
  \caption{caption}
  \label{label}
\end{table}

\subsection{Output recommendations}
\label{sub:output_recommendations}

Latex: pdf/ps/png.  Make sure to use \texttt{$\backslash$DeclareGraphicsExtensions\{.png, .pdf\}}.  

Windows word: wmf (but no transparency) or pdf.

Web (png).  

Some publishers: TIFF, 600 dpi

\subsection{\f{ggsave}}
\label{sub:ggsave}

For interactive use, \f{ggsave}, will use the size of the current graphics device (useful for ensuring a good aspect ratio), but for most uses it's recommending to set width and height (in inches).



\input{_footer.tex}